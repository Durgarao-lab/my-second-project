<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mechanic Signup</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg,#1f4037, #99f2c8); height: 100vh; display: flex; justify-content: center; align-items: center; }
    .signup-box { background: white; padding: 30px; width: 350px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    h2 { text-align: center; }
    input, select, button { width: 100%; padding: 10px; margin-top: 10px; }
    button { background: #232526; color: white; border: none; cursor: pointer; }
    button:hover { background: #000; }
    .otp-box { display: none; }
    .login-link { text-align: center; margin-top: 15px; }
    .login-link a { text-decoration: none; color: #232526; font-weight: bold; }
  </style>
</head>
<body>

<div class="signup-box">
  <h2>Mechanic Signup</h2>

  <form action="/signup_mechanic" method="POST" onsubmit="return checkBeforeSignup()">
    <input type="text" name="name" id="name" placeholder="Full Name" required>
    <input type="email" name="email" id="email" placeholder="Email" required>

    <button type="button" onclick="sendOTP()">Verify Email with OTP</button>

    <div id="otpBox" class="otp-box">
      <input type="text" id="otp" placeholder="Enter OTP">
      <button type="button" onclick="verifyOTP()">Verify OTP</button>
    </div>

    <input type="text" name="phone" placeholder="Phone Number" required>

    <select name="service" required>
      <option value="">Choose Specialized Service</option>
      <option value="Bike Mechanic">Bike Mechanic</option>
      <option value="Engine Mechanic">Engine Mechanic</option>
      <option value="Bike Wiring">Bike Wiring</option>
      <option value="General Mechanic">General Mechanic</option>
    </select>

    <input type="password" name="password" placeholder="Password" required>

    <button type="submit">Signup</button>
  </form>

  <div class="login-link">
    Already have an account? <a href="/mechanic_login">Login</a>
  </div>
</div>

<script>
let otpVerified = false;

// SEND OTP
async function sendOTP() {
  const email = document.getElementById("email").value;
  if (!email) return alert("Enter email first!");

  const res = await fetch("/send-otp", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `email=${email}`
  });

  const text = await res.text();
  if (text === "OTP Sent") {
    alert("OTP Sent to Email!");
    document.getElementById("otpBox").style.display = "block";
  } else {
    alert("Failed to send OTP ❌");
  }
}

// VERIFY OTP
async function verifyOTP() {
  const email = document.getElementById("email").value;
  const otp = document.getElementById("otp").value;

  const res = await fetch("/verify-otp", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `email=${email}&otp=${otp}`
  });

  const text = await res.text();
  if (text === "OTP verified") {
    otpVerified = true;
    alert("Verified Successfully ✅");
    document.getElementById("otpBox").style.display = "none";
  } else {
    alert("❌ Wrong OTP");
  }
}

// BLOCK SUBMIT IF OTP NOT VERIFIED
function checkBeforeSignup() {
  if (!otpVerified) {
    alert("⚠ Verify OTP before signing up!");
    return false;
  }
  return true;
}
</script>

</body>
</html>